syntax = "proto3";

package coop.drivers.dispatch.v1beta1;

option go_package = "github.com/kevinmichaelchen/api-dispatch/internal/idl/coop/drivers/dispatch/v1beta1";

import "coop/drivers/dispatch/v1beta1/latlng.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";

service DispatchService {
  // Bulk-ingest driver locations.
  rpc UpdateDriverLocations(UpdateDriverLocationsRequest) returns (UpdateDriverLocationsResponse) {}

  // Gets the nearest drivers to a given point.
  rpc GetNearestDrivers(GetNearestDriversRequest) returns (GetNearestDriversResponse) {}
}

message DriverLocation {
  string driver_id = 1;
  google.protobuf.Timestamp timestamp = 2;
  LatLng lat_lng = 3;
}

message UpdateDriverLocationsRequest {
  repeated DriverLocation locations = 1;
}

message UpdateDriverLocationsResponse {}

message GetNearestDriversRequest {
  LatLng location = 1;
  int32 limit = 2;
}

message GetNearestDriversResponse {
  repeated SearchResult results = 1;
  string pickup_address = 2;
}

message SearchResult {
  // Driver's ID
  string driver_id = 1;
  // Driver's distance from the pickup location (in meters)
  double distance_meters = 2;
  // Time it takes driver to go to pickup
  google.protobuf.Duration duration = 3;
  // Driver's current location
  LatLng driver_location = 4;
  // Driver's current location as a human-readable address
  string address = 5;
  // what resolution the driver was found to be a k=1 k-ring neighbor to the
  // pickup location. if resolution is 7, that means the highest (finest)
  // resolution in which the driver appeared in the pickup location's
  // neighborhood was 7.
  int32 resolution = 6;
  // if k=1, it's an immediate (1st degree) neighbor. if k=2, it's a 2nd-degree
  // neighbor (i.e., a neighbor's neighbor).
  int32 k_value = 7;
}